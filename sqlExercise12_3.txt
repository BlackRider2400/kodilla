CREATE TABLE ISSUESLISTS
(
	ID SERIAL PRIMARY KEY,
    NAME VARCHAR(100) CHARSET utf8
);

CREATE TABLE ISSUES
(
	ID SERIAL PRIMARY KEY,
    ISSUESLIST_ID BIGINT UNSIGNED NOT NULL,
    FOREIGN KEY (ISSUESLIST_ID) REFERENCES ISSUESLISTS(ID),
    SUMMARY VARCHAR(100) CHARSET utf8,
    DESCRIPTION VARCHAR(4000) CHARSET utf8,
    USER_ID_ASSIGNEDTO BIGINT UNSIGNED NOT NULL,
    FOREIGN KEY (USER_ID_ASSIGNEDTO) REFERENCES USERS(ID)
);

INSERT ISSUESLISTS(NAME)
VALUES ("ToDo");
INSERT ISSUESLISTS(NAME)
VALUES ("In progress");
INSERT ISSUESLISTS(NAME)
VALUES ("Done");
COMMIT;

INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (1, "walk with dog", "go to park with a dog", 2);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (1, "drink water", "just drink it", 1);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (1, "make dinner", "cook pasta with spicy tomato souse", 3);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (1, "buy bread", "go to bakery and get the cheapest bread", 1);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (1, "feed cat", "find cat food and then put it to cats bowl", 5);
COMMIT;

INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (2, "walk with cat", "go to park with a cat", 4);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (2, "walk with parrot", "go to park with a parrot", 2);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (2, "buy toilet paper", "go to lidl and get the softest toilet paper", 5);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (2, "paint house", "paint whole walls which are outside", 1);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (2, "order pizza", "call 387629323 for two pizzas margharitas", 2);
COMMIT;

INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (3, "get christmass tree", "go to forest and cut off nice tree", 3);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (3, "go vote", "go out from your house and vot", 4);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (3, "water plants", "get some water and water them", 3);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (3, "print tickets", "download tickets from gmail and print them in A4", 1);
INSERT ISSUES(ISSUESLIST_ID, SUMMARY, DESCRIPTION, USER_ID_ASSIGNEDTO)
VALUES (3, "install windows update", "open Johns laptop and update his windows", 5);
COMMIT;

/*
EXERCISE 12.5
*/

SELECT IL.NAME, I.SUMMARY FROM ISSUESLISTS IL
JOIN ISSUES I ON IL.ID = I.ISSUESLIST_ID;


SELECT U.FIRSTNAME, I.SUMMARY
FROM ISSUES I JOIN USERS U ON I.USER_ID_ASSIGNEDTO = U.ID;


SELECT U.FIRSTNAME, U.LASTNAME, COUNT(*) AS TASK_NUMBER
FROM ISSUES I JOIN USERS U ON U.ID = I.USER_ID_ASSIGNEDTO
GROUP BY U.ID
HAVING TASK_NUMBER > 0
ORDER BY U.LASTNAME, U.LASTNAME;
